{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "This template coordinates the running of the GitLab S3 and IAM templates.",
  "Parameters": {
    "GitlabBucket": {
      "Description": "S3 Bucket to host GitLab files",
      "Type": "String",
      "AllowedPattern": "^[a-zA-Z][a-zA-Z0-9-]*[a-zA-Z0-9]*$"
    },
    "GitlabBucketTemplate": {
      "Description": "URL to the child-template for creating the gitlab-bucket.",
      "Type": "String",
      "AllowedPattern": "^$|^http://.*$|^https://.*$"
    },
    "BucketIamTemplate": {
      "Description": "URL to the child-template for creating the gitlab-bucket(s) IAM roles.",
      "Type": "String",
      "AllowedPattern": "^$|^http://.*$|^https://.*$"
    }
  },
  "Metadata": {
    "AWS::CloudFormation::Interface": {
      "ParameterGroups": [
        {
          "Label": {
            "default": "Stack Bucket Objects"
          },
          "Parameters": [
            "GitlabBucket"
          ]
        },
        {
          "Label": {
            "default": "Stack child-templates"
          },
          "Parameters": [
            "GitlabBucketTemplate",
            "BucketIamTemplate"
          ]
        }
      ]
    }
  },
  "Resources": {
    "GitlabBucketRes": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": { "Ref": "GitlabBucketTemplate" },
        "Parameters": {
          "GitlabBucket": { "Ref": "GitlabBucket" }
        },
        "TimeoutInMinutes": "10"
      }
    },
    "IamBucketRes": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": { "Ref": "BucketIamTemplate" },
        "Parameters": {
          "GitlabBucket": { "Ref": "GitlabBucket" }
        },
        "TimeoutInMinutes": "10"
      }
    }
  }
}
